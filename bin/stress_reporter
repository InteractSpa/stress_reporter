#!/usr/bin/env ruby

require 'rubygems'
require 'logger'

logger = Logger.new("/tmp/check_senato_status_#{Time.now.strftime('%Y.%d.%m')}.log")
puts "Goingo to check on load avarage of #{StressReporter::Checker.load_avarage} against a limit of #{StressReporterChecker::LIMIT}"

while true do
  begin
    Timeout::timeout(3) do
      if StressReporter::Checker.go?
        StressReporter::Actions::Xmanager.report.each {|l|
          line = "#{Time.now.strftime('%Y/%d/%m %H:%M:%S')}\t#{StressReporter::Checker.load_average}\t#{ line }"
          puts line
          logger.info line
        }
      end
    end
  rescue Timeout::Error => ex
    logger.error "#{Time.now.strftime('%Y/%d/%m %H:%M:%S')} Timeout Error!"
  end
end
